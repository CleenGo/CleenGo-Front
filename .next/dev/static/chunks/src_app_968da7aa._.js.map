{
  "version": 3,
  "sources": [],
  "sections": [
<<<<<<< HEAD
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/miran/Desktop/CleenGo/CleenGo-Front/src/app/services/supabaseClient.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.VITE_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.VITE_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.error(\r\n    \"❌ ERROR: Las variables VITE_SUPABASE_URL o VITE_SUPABASE_ANON_KEY NO están accesibles en el cliente.\"\r\n  );\r\n  throw new Error(\"Faltan variables de entorno de Supabase en el cliente.\");\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n"],"names":[],"mappings":";;;;AAIoB;AAFpB;AAFA;;AAIA,MAAM;AACN,MAAM;AAEN;;AAOO,MAAM,WAAW,IAAA,0MAAY,EAAC,aAAa"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/miran/Desktop/CleenGo/CleenGo-Front/src/app/services/http.ts"],"sourcesContent":["import axios from \"axios\";\r\n\r\nexport const http = axios.create({\r\n  baseURL: process.env.VITE_BACKEND_URL || \"http://localhost:3000\",\r\n  withCredentials: true,\r\n});\r\n"],"names":[],"mappings":";;;;AAGW;AAHX;;AAEO,MAAM,OAAO,mJAAK,CAAC,MAAM,CAAC;IAC/B,SAAS,8DAAgC;IACzC,iBAAiB;AACnB"}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/miran/Desktop/CleenGo/CleenGo-Front/src/app/services/auth.ts"],"sourcesContent":["// src/app/services/auth.ts\r\n\r\nimport { http } from \"./http\";\r\n\r\n// --------- Tipos para registro normal ---------\r\nexport interface RegisterClientRequest {\r\n  name: string;\r\n  surname: string;\r\n  email: string;\r\n  password: string;\r\n  confirmPassword: string;\r\n  birthDate: string;\r\n  profileImgUrl?: string;\r\n  phone: string;\r\n}\r\n\r\nexport interface RegisterClientResponse {\r\n  message: string;\r\n  user: any;\r\n  token?: string; // por si el backend devuelve token al registrar\r\n}\r\n\r\nexport interface RegisterProviderRequest {\r\n  name: string;\r\n  surname: string;\r\n  email: string;\r\n  password: string;\r\n  confirmPassword: string;\r\n  birthDate: string;\r\n  profileImgUrl?: string;\r\n  phone: string;\r\n\r\n  // Campos específicos del provider:\r\n  days: string[];  \r\n  hours: string[];  \r\n  about: string;    \r\n}\r\n\r\nexport interface RegisterProviderResponse {\r\n  message: string;\r\n  provider: any;\r\n  token?: string;\r\n}\r\n\r\n\r\n// --------- Tipos para login normal ---------\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface LoginResponse {\r\n  message: string;\r\n  accessToken: string;\r\n  user: any;\r\n}\r\n\r\n// --------- Tipos para login por terceros (OAuth) ---------\r\nexport interface ThirdPartyLoginRequest {\r\n  accessToken: string;\r\n  name: string | null;\r\n  surname: string | null;\r\n  phone: string | null;\r\n  profileImgUrl: string | null;\r\n}\r\n\r\nexport interface ThirdPartyLoginResponse {\r\n  message: string;\r\n  accessToken: string;\r\n  user: any;\r\n}\r\n\r\n// --------- Servicios ---------\r\nexport async function registerClient(data: RegisterClientRequest) {\r\n  const response = await http.post<RegisterClientResponse>(\r\n    \"/auth/register/client\",\r\n    data\r\n  );\r\n  return response.data;\r\n}\r\n\r\nexport async function login(data: LoginRequest) {\r\n  const response = await http.post<LoginResponse>(\"/auth/login\", data);\r\n  return response.data;\r\n}\r\n\r\nexport async function registerProvider(data: RegisterProviderRequest) {\r\n  const response = await http.post<RegisterProviderResponse>(\r\n    \"/auth/register/provider\",\r\n    data\r\n  );\r\n  return response.data;\r\n}\r\n\r\n\r\n// Login / registro con Google (Supabase OAuth)\r\nexport async function thirdPartyLogin(\r\n  role: \"client\" | \"provider\",\r\n  data: ThirdPartyLoginRequest\r\n) {\r\n  const response = await http.post<ThirdPartyLoginResponse>(\r\n    `/auth/third-party/${role}`,\r\n    data\r\n  );\r\n  return response.data;\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;;;;;;;AAE3B;;AAuEO,eAAe,eAAe,IAA2B;IAC9D,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAC9B,yBACA;IAEF,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,MAAM,IAAkB;IAC5C,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAAgB,eAAe;IAC/D,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,iBAAiB,IAA6B;IAClE,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAC9B,2BACA;IAEF,OAAO,SAAS,IAAI;AACtB;AAIO,eAAe,gBACpB,IAA2B,EAC3B,IAA4B;IAE5B,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAC9B,CAAC,kBAAkB,EAAE,MAAM,EAC3B;IAEF,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/miran/Desktop/CleenGo/CleenGo-Front/src/app/oauth/callback/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { supabase } from \"../../services/supabaseClient\";\r\nimport { thirdPartyLogin } from \"../../services/auth\";\r\n\r\nexport default function OAuthCallbackPage() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  const role = (searchParams.get(\"role\") as \"client\" | \"provider\") || \"client\";\r\n\r\n  useEffect(() => {\r\n    const processOAuthLogin = async () => {\r\n      try {\r\n        console.log(\"➡️ Entró a OAuthCallbackPage (Next)\");\r\n        console.log(\"➡️ role =>\", role);\r\n        if (typeof window === \"undefined\") return;\r\n\r\n        console.log(\"➡️ location.href =>\", window.location.href);\r\n        console.log(\"➡️ location.hash =>\", window.location.hash);\r\n\r\n        // 1. Intentar sacar access_token del hash de la URL\r\n        let accessToken: string | null = null;\r\n\r\n        if (window.location.hash) {\r\n          const hash = window.location.hash.replace(\"#\", \"\");\r\n          const hashParams = new URLSearchParams(hash);\r\n          accessToken = hashParams.get(\"access_token\");\r\n        }\r\n\r\n        console.log(\"➡️ accessToken desde hash =>\", accessToken);\r\n\r\n        // 2. Si no hay token en el hash, usar getSession() como respaldo\r\n        if (!accessToken) {\r\n          const { data, error } = await supabase.auth.getSession();\r\n          console.log(\"➡️ getSession() data =>\", data);\r\n          console.log(\"➡️ getSession() error =>\", error);\r\n\r\n          if (!error && data.session) {\r\n            accessToken = data.session.access_token;\r\n          }\r\n        }\r\n\r\n        if (!accessToken) {\r\n          console.error(\r\n            \"⛔ No se encontró accessToken ni en hash ni en sesión\"\r\n          );\r\n          alert(\"No se pudo obtener el token de Google/Supabase.\");\r\n          router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        // 3. Obtener info básica del usuario desde Supabase\r\n        const { data: userData, error: userError } =\r\n          await supabase.auth.getUser(accessToken);\r\n\r\n        if (userError || !userData?.user) {\r\n          console.error(\"⛔ Error al obtener usuario de Supabase:\", userError);\r\n          alert(\"Error al validar usuario en Supabase.\");\r\n          router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        const supaUser = userData.user;\r\n\r\n        const body = {\r\n          accessToken,\r\n          name:\r\n            supaUser.user_metadata?.name ||\r\n            supaUser.user_metadata?.full_name ||\r\n            null,\r\n          surname: supaUser.user_metadata?.surname ?? null,\r\n          phone: supaUser.user_metadata?.phone ?? null,\r\n          profileImgUrl: supaUser.user_metadata?.avatar_url ?? null,\r\n        };\r\n\r\n        console.log(\"➡️ Body enviado al back =>\", body);\r\n\r\n        // 4. Llamar al back (mismo cliente http que login/register)\r\n        const dataBack = await thirdPartyLogin(role, body);\r\n        console.log(\"✅ Data back =>\", dataBack);\r\n\r\n        // Guardar en localStorage para que AuthContext lo lea\r\n        localStorage.setItem(\"token\", dataBack.accessToken);\r\n        localStorage.setItem(\"user\", JSON.stringify(dataBack.user));\r\n\r\n        // Limpiar hash de la URL\r\n        window.history.replaceState({}, document.title, \"/\");\r\n\r\n        // Redirección según rol\r\n        if (role === \"client\") {\r\n          router.push(\"/\");\r\n        } else {\r\n          router.push(\"/dashboard/provider\");\r\n        }\r\n      } catch (err) {\r\n        console.error(\"⛔ Error en OAuthCallback (Next):\", err);\r\n        alert(\"Error inesperado en autenticación.\");\r\n        router.push(\"/login\");\r\n      }\r\n    };\r\n\r\n    processOAuthLogin();\r\n  }, [router, role]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100 text-gray-700\">\r\n      <div className=\"bg-white shadow-md rounded-xl p-6 text-center w-80\">\r\n        <h2 className=\"text-lg font-semibold mb-2\">Conectando con Google…</h2>\r\n        <p className=\"text-sm text-gray-500\">Por favor espera unos segundos.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
=======
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Agustina/Desktop/PF-HENRY-AMORENOPORTAS/CleenGo-Front/src/app/services/supabaseClient.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.VITE_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.VITE_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.error(\r\n    \"❌ ERROR: Las variables VITE_SUPABASE_URL o VITE_SUPABASE_ANON_KEY NO están accesibles en el cliente.\"\r\n  );\r\n  throw new Error(\"Faltan variables de entorno de Supabase en el cliente.\");\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n"],"names":[],"mappings":";;;;AAIoB;AAFpB;AAFA;;AAIA,MAAM;AACN,MAAM;AAEN;;AAOO,MAAM,WAAW,IAAA,0MAAY,EAAC,aAAa"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Agustina/Desktop/PF-HENRY-AMORENOPORTAS/CleenGo-Front/src/app/services/http.ts"],"sourcesContent":["import axios from \"axios\";\r\n\r\nexport const http = axios.create({\r\n  baseURL: process.env.VITE_BACKEND_URL || \"http://localhost:3000\",\r\n  withCredentials: true,\r\n});\r\n"],"names":[],"mappings":";;;;AAGW;AAHX;;AAEO,MAAM,OAAO,mJAAK,CAAC,MAAM,CAAC;IAC/B,SAAS,8DAAgC;IACzC,iBAAiB;AACnB"}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Agustina/Desktop/PF-HENRY-AMORENOPORTAS/CleenGo-Front/src/app/services/auth.ts"],"sourcesContent":["// src/app/services/auth.ts\r\n\r\nimport { http } from \"./http\";\r\n\r\n// --------- Tipos para registro normal ---------\r\nexport interface RegisterClientRequest {\r\n  name: string;\r\n  surname: string;\r\n  email: string;\r\n  password: string;\r\n  confirmPassword: string;\r\n  birthDate: string;\r\n  profileImgUrl?: string;\r\n  phone: string;\r\n}\r\n\r\nexport interface RegisterClientResponse {\r\n  message: string;\r\n  user: any;\r\n  token?: string; // por si el backend devuelve token al registrar\r\n}\r\n\r\nexport interface RegisterProviderRequest {\r\n  name: string;\r\n  surname: string;\r\n  email: string;\r\n  password: string;\r\n  confirmPassword: string;\r\n  birthDate: string;\r\n  profileImgUrl?: string;\r\n  phone: string;\r\n\r\n  // Campos específicos del provider:\r\n  days: string[];  \r\n  hours: string[];  \r\n  about: string;    \r\n}\r\n\r\nexport interface RegisterProviderResponse {\r\n  message: string;\r\n  provider: any;\r\n  token?: string;\r\n}\r\n\r\n\r\n// --------- Tipos para login normal ---------\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface LoginResponse {\r\n  message: string;\r\n  accessToken: string;\r\n  user: any;\r\n}\r\n\r\n// --------- Tipos para login por terceros (OAuth) ---------\r\nexport interface ThirdPartyLoginRequest {\r\n  accessToken: string;\r\n  name: string | null;\r\n  surname: string | null;\r\n  phone: string | null;\r\n  profileImgUrl: string | null;\r\n}\r\n\r\nexport interface ThirdPartyLoginResponse {\r\n  message: string;\r\n  accessToken: string;\r\n  user: any;\r\n}\r\n\r\n// --------- Servicios ---------\r\nexport async function registerClient(data: RegisterClientRequest) {\r\n  const response = await http.post<RegisterClientResponse>(\r\n    \"/auth/register/client\",\r\n    data\r\n  );\r\n  return response.data;\r\n}\r\n\r\nexport async function login(data: LoginRequest) {\r\n  const response = await http.post<LoginResponse>(\"/auth/login\", data);\r\n  return response.data;\r\n}\r\n\r\nexport async function registerProvider(data: RegisterProviderRequest) {\r\n  const response = await http.post<RegisterProviderResponse>(\r\n    \"/auth/register/provider\",\r\n    data\r\n  );\r\n  return response.data;\r\n}\r\n\r\n\r\n// Login / registro con Google (Supabase OAuth)\r\nexport async function thirdPartyLogin(\r\n  role: \"client\" | \"provider\",\r\n  data: ThirdPartyLoginRequest\r\n) {\r\n  const response = await http.post<ThirdPartyLoginResponse>(\r\n    `/auth/third-party/${role}`,\r\n    data\r\n  );\r\n  return response.data;\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;;;;;;;AAE3B;;AAuEO,eAAe,eAAe,IAA2B;IAC9D,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAC9B,yBACA;IAEF,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,MAAM,IAAkB;IAC5C,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAAgB,eAAe;IAC/D,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,iBAAiB,IAA6B;IAClE,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAC9B,2BACA;IAEF,OAAO,SAAS,IAAI;AACtB;AAIO,eAAe,gBACpB,IAA2B,EAC3B,IAA4B;IAE5B,MAAM,WAAW,MAAM,yIAAI,CAAC,IAAI,CAC9B,CAAC,kBAAkB,EAAE,MAAM,EAC3B;IAEF,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Agustina/Desktop/PF-HENRY-AMORENOPORTAS/CleenGo-Front/src/app/oauth/callback/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { supabase } from \"../../services/supabaseClient\";\r\nimport { thirdPartyLogin } from \"../../services/auth\";\r\n\r\nexport default function OAuthCallbackPage() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  const role = (searchParams.get(\"role\") as \"client\" | \"provider\") || \"client\";\r\n\r\n  useEffect(() => {\r\n    const processOAuthLogin = async () => {\r\n      try {\r\n        console.log(\"➡️ Entró a OAuthCallbackPage (Next)\");\r\n        console.log(\"➡️ role =>\", role);\r\n        if (typeof window === \"undefined\") return;\r\n\r\n        console.log(\"➡️ location.href =>\", window.location.href);\r\n        console.log(\"➡️ location.hash =>\", window.location.hash);\r\n\r\n        // 1. Intentar sacar access_token del hash de la URL\r\n        let accessToken: string | null = null;\r\n\r\n        if (window.location.hash) {\r\n          const hash = window.location.hash.replace(\"#\", \"\");\r\n          const hashParams = new URLSearchParams(hash);\r\n          accessToken = hashParams.get(\"access_token\");\r\n        }\r\n\r\n        console.log(\"➡️ accessToken desde hash =>\", accessToken);\r\n\r\n        // 2. Si no hay token en el hash, usar getSession() como respaldo\r\n        if (!accessToken) {\r\n          const { data, error } = await supabase.auth.getSession();\r\n          console.log(\"➡️ getSession() data =>\", data);\r\n          console.log(\"➡️ getSession() error =>\", error);\r\n\r\n          if (!error && data.session) {\r\n            accessToken = data.session.access_token;\r\n          }\r\n        }\r\n\r\n        if (!accessToken) {\r\n          console.error(\r\n            \"⛔ No se encontró accessToken ni en hash ni en sesión\"\r\n          );\r\n          alert(\"No se pudo obtener el token de Google/Supabase.\");\r\n          router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        // 3. Obtener info básica del usuario desde Supabase\r\n        const { data: userData, error: userError } =\r\n          await supabase.auth.getUser(accessToken);\r\n\r\n        if (userError || !userData?.user) {\r\n          console.error(\"⛔ Error al obtener usuario de Supabase:\", userError);\r\n          alert(\"Error al validar usuario en Supabase.\");\r\n          router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        const supaUser = userData.user;\r\n\r\n        const body = {\r\n          accessToken,\r\n          name:\r\n            supaUser.user_metadata?.name ||\r\n            supaUser.user_metadata?.full_name ||\r\n            null,\r\n          surname: supaUser.user_metadata?.surname ?? null,\r\n          phone: supaUser.user_metadata?.phone ?? null,\r\n          profileImgUrl: supaUser.user_metadata?.avatar_url ?? null,\r\n        };\r\n\r\n        console.log(\"➡️ Body enviado al back =>\", body);\r\n\r\n        // 4. Llamar al back (mismo cliente http que login/register)\r\n        const dataBack = await thirdPartyLogin(role, body);\r\n        console.log(\"✅ Data back =>\", dataBack);\r\n\r\n        // Guardar en localStorage para que AuthContext lo lea\r\n        localStorage.setItem(\"token\", dataBack.accessToken);\r\n        localStorage.setItem(\"user\", JSON.stringify(dataBack.user));\r\n\r\n        // Limpiar hash de la URL\r\n        window.history.replaceState({}, document.title, \"/\");\r\n\r\n        // Redirección según rol\r\n        if (role === \"client\") {\r\n          router.push(\"/\");\r\n        } else {\r\n          router.push(\"/dashboard/provider\");\r\n        }\r\n      } catch (err) {\r\n        console.error(\"⛔ Error en OAuthCallback (Next):\", err);\r\n        alert(\"Error inesperado en autenticación.\");\r\n        router.push(\"/login\");\r\n      }\r\n    };\r\n\r\n    processOAuthLogin();\r\n  }, [router, role]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100 text-gray-700\">\r\n      <div className=\"bg-white shadow-md rounded-xl p-6 text-center w-80\">\r\n        <h2 className=\"text-lg font-semibold mb-2\">Conectando con Google…</h2>\r\n        <p className=\"text-sm text-gray-500\">Por favor espera unos segundos.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
>>>>>>> 27ce524af4ccf90a33772df580a3d62f5aee0f33
}